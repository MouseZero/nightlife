const { Router } = require('express')
const pg = require('pg')
const { database: config } = require('../config.json')
const pool = new pg.Pool(config)
const usersDb = require('./persistence/users-factory')(pool)
const userRoutes = require('./users-routes')
const searchRoutes = require('./search-routes')()
const { errorHandler, testError } = require('./custom-errors')
const { authenticate, mustHaveJWT } = require('./jwt-middleware')(usersDb)

const router = Router()
module.exports = router
  .use('/users', userRoutes(usersDb))
  .post('/authenticate', authenticate)
  .get('/testError', testError)
  // .use(mustHaveJWT)
  .use('/search', searchRoutes)
  .use(errorHandler)
